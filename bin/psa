#!/usr/bin/env ruby

require 'psadmin_plus'

# options
opts_c = ARGV.shift || "help"
opts_t = ARGV.shift || "all"
opts_d = ARGV.shift || "all"

commands = opts_c.split(',')
types = opts_t.split(',')
domains = opts_d.split(',')

if types.include? "all" then types = ['app','prcs','web'] end
if domains.include? "all" then all_domains = true end

# constants
OS_CONST = os
PS_RUNTIME_USER = "psadm2"     # TODO
PS_POOL_MGMT = "on"           # TODO
PS_HEALTH_FILE = "health.html" # TODO
PS_HEALTH_TIME = "60"          # TODO
PS_PSA_SUDO = "on"             # TODO
IS_RUNTIME_USER = false        # TODO

# process
commands.each do |c|
    case "#{c}"
    when "help"
        do_help
    when "util"
        do_util
    when "list"
        do_list
    when "summary"
        do_summary
    else
        types.each do |t|
            if all_domains then
                case "#{t}"
                when "app"
                    domains = find_apps
                when "prcs"
                    domains = find_prcss
                when "web"
                    domains = find_webs
                end
            end
            domains.each do |d|
                case "#{c}"
                when "status"
                    do_status(t,d)
                when "start"
                    do_start(t,d)
                when "stop"
                    do_stop(t,d)
                when "kill"
                    do_kill(t,d)
                when "configure"
                    do_configure(t,d)
                when "purge"
                    do_purge(t,d)
                when "flush"
                    do_flush(t,d)
                when "restart"
                    do_restart(t,d)
                when "bounce"
                    do_bounce(t,d)
                when "pooladd"
                    do_pooladd(t,d)
                when "poolrm"
                    do_poolrm(t,d)
                else
                    puts "Not a valid command. See psa help"
                end
            end
        end
    end
end
